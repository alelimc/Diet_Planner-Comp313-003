<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Create Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10" 
        th:integrity="@{sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC}" 
        th:crossorigin="@{anonymous}"></script>
    <meta name="csrf-token" th:content="${_csrf.token}" />
	<meta name="csrf-header" th:content="${_csrf.headerName}" />
</head>
<body class="bg-gray-100 text-gray-900">
    <nav class="flex justify-between items-center p-4 shadow bg-white">
        <a href="/dashboard" class="text-lg font-bold flex items-center">
            <img src="/img/home-icon.svg" alt="Home" class="h-6 w-6 mr-2"> Dashboard
        </a>
		<div class="flex items-center space-x-4">
           <span class="font-semibold" th:text="${username}"></span>
           <a href="/settings" class="text-blue-500 hover:underline">Settings</a>
           <a href="/myplans" class="text-blue-500 hover:underline">My Plans</a>
           <a href="/createplan" class="text-blue-500 hover:underline">Create Plan</a>
           <a href="/logout" class="text-red-500 hover:underline">Logout</a>
       	</div>
    </nav>

    <!-- Page Content -->    
    <section class="p-6">
        <h1 class="text-3xl font-bold">Create Meal Plan, <span th:text="${username}"></span></h1>
        <p class="text-gray-600 mt-2">Customize and generate your meal plan.</p>
        
        <!-- User Info -->
        <section class="p-6 mt-6 bg-white shadow rounded-md">
			<div>
				<p>
					<strong>Daily Caloric Intake Goal:</strong> <span th:text="${caloricIntakeGoal}"></span>
				</p>
				<p>
					<strong>Diet Preference:</strong> <span th:text="${dietPreference}"></span>
				</p>

			</div>
		</section>
		<!-- Generate Meal Plan button -->
		<div class="flex justify-center items-center mt-4">
			<button th:hx-post="@{/createplan/generate-mealplan}" 
				th:hx-target="@{#meals}"
				th:hx-swap="@{outerHTML}"
				class="text-blue-500 hover:underline">
				Generate Meal Plan
			</button>
			<!-- <form action="/createplan/generate-mealplan" method="post">
				<button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
					Generate Meal Plan
				</button>
			</form> -->
		</div>
		<!-- Table for list of meals -->
		<div class="flex justify-center items-center mt-4">
			<table id="meals" class="table-auto" th:replace="~{fragments/meals :: meals (meals=${meals})}"></table>
		</div>
    </section>
</body>

	<script>
			document.body.addEventListener('htmx:configRequest', (evt) => {
				  evt.detail.headers['accept'] = 'text/html-partial';
				  if (evt.detail.verb !== 'get') {
				    const csrfHeader = document.querySelector('meta[name=csrf-header]').getAttribute('content');
				    const csrfToken = document.querySelector('meta[name=csrf-token]').getAttribute('content');
				    if (csrfHeader != null && csrfToken != null) {
				      evt.detail.headers[csrfHeader] = csrfToken;
				    }
				  }
				});
	</script>
	
</html>
